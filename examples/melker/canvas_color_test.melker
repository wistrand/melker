<melker>
  <container style="width: fill; height: fill; border: thin; padding: 1; display: flex; flex-direction: column; align-items: center;">
    <text style="font-weight: bold; margin-bottom: 1;">
      Canvas Color Test - Multiple Colors
    </text>

    <container style="width: fill; height: fill;">
      <canvas
        id="testCanvas"
        width="60"
        height="20"
        style="width: fill; height: fill"
        dither="$ENV{DITHER:-none}"
        ditherBits="1"
        onPaint="$app.drawColoredShapes(event.canvas)"
      />
    </container>

    <text style="color: gray; margin-top: 1;">
      Colored circles and rectangles - Resize to redraw
    </text>
  </container>

  <script type="typescript">
    // Draw colored shapes on the canvas using its actual bounds
    export const drawColoredShapes = (canvas: any): void => {
      // Get layout bounds from the canvas element
      const bounds = canvas.getBounds();
      if (!bounds) return;

      // Resize canvas to match layout bounds
      if (canvas.props.width !== bounds.width || canvas.props.height !== bounds.height) {
        canvas.setSize(bounds.width, bounds.height);
      }

      // Clear canvas
      canvas.clear();

      // Get canvas dimensions in pixels
      const { width, height } = canvas.getBufferSize();
      const centerX = Math.floor(width / 2);
      const centerY = Math.floor(height / 2);

      // Calculate radius based on smaller visual dimension
      const visualSize = canvas.getVisualSize();
      const maxRadius = Math.min(visualSize.width, visualSize.height) / 2 - 4;

      // Draw concentric circles in different colors
      const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
      for (let i = 0; i < 6; i++) {
        const radius = Math.floor(maxRadius * (1 - i * 0.15));
        if (radius > 0) {
          canvas.drawCircleCorrectedColor(centerX, centerY, radius, colors[i]);
        }
      }

      // Draw colored rectangles in corners
      const rectSize = 12;

      // Top-left: red
      canvas.fillRectColor(2, 2, rectSize * 2, rectSize, '#ff0000');

      // Top-right: green
      canvas.fillRectColor(width - rectSize * 2 - 2, 2, rectSize * 2, rectSize, '#00ff00');

      // Bottom-left: blue
      canvas.fillRectColor(2, height - rectSize - 2, rectSize * 2, rectSize, '#0000ff');

      // Bottom-right: yellow
      canvas.fillRectColor(width - rectSize * 2 - 2, height - rectSize - 2, rectSize * 2, rectSize, '#ffff00');

      // Draw some colored lines
      canvas.drawLineColor(0, height / 2, width, height / 2, '#ffffff');
      canvas.drawLineColor(width / 2, 0, width / 2, height, '#ffffff');
    };

  </script>
</melker>
