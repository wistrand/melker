<melker>
  <script type="typescript">
    // Draw colored shapes on the canvas
    const drawColoredShapes = (canvas: any): void => {
      // Clear canvas
      canvas.clear();

      // Get canvas dimensions in pixels
      const { width, height } = canvas.getBufferSize();
      const centerX = Math.floor(width / 2);
      const centerY = Math.floor(height / 2);

      // Calculate radius based on smaller visual dimension
      const visualSize = canvas.getVisualSize();
      const maxRadius = Math.min(visualSize.width, visualSize.height) / 2 - 4;

      // Draw concentric circles in different colors
      const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
      for (let i = 0; i < 6; i++) {
        const radius = Math.floor(maxRadius * (1 - i * 0.15));
        if (radius > 0) {
          canvas.drawCircleCorrectedColor(centerX, centerY, radius, colors[i]);
        }
      }

      // Draw colored rectangles in corners
      const rectSize = 12;

      // Top-left: red
      canvas.fillRectColor(2, 2, rectSize * 2, rectSize, '#ff0000');

      // Top-right: green
      canvas.fillRectColor(width - rectSize * 2 - 2, 2, rectSize * 2, rectSize, '#00ff00');

      // Bottom-left: blue
      canvas.fillRectColor(2, height - rectSize - 2, rectSize * 2, rectSize, '#0000ff');

      // Bottom-right: yellow
      canvas.fillRectColor(width - rectSize * 2 - 2, height - rectSize - 2, rectSize * 2, rectSize, '#ffff00');

      // Draw some colored lines
      canvas.drawLineColor(0, height / 2, width, height / 2, '#ffffff');
      canvas.drawLineColor(width / 2, 0, width / 2, height, '#ffffff');
    };

    // Register resize handler
    context.engine.onResize((event: any) => {
      const canvas = context.getElementById('testCanvas');
      if (!canvas) return;

      // Calculate new canvas size based on terminal size
      const { newSize } = event;
      const canvasWidth = Math.max(20, newSize.width - 4);
      const canvasHeight = Math.max(10, newSize.height - 6);

      // Resize the canvas
      canvas.setSize(canvasWidth, canvasHeight);

      // Redraw shapes
      drawColoredShapes(canvas);
    });

    // Initial draw on mount
    context.engine.onMount(() => {
      const canvas = context.getElementById('testCanvas');
      if (canvas) {
        // Calculate initial canvas size based on current terminal size
        const terminalSize = context.engine.getTerminalSize();
        const canvasWidth = Math.max(20, terminalSize.width - 4);
        const canvasHeight = Math.max(10, terminalSize.height - 6);

        // Resize the canvas to fit
        canvas.setSize(canvasWidth, canvasHeight);

        // Initial draw
        drawColoredShapes(canvas);

        // Force render
        canvas.markDirty();
        context.engine.render();
      }
    });
  </script>

  <container style="width: fill; height: fill; border: thin; padding: 1; display: flex; flex-direction: column; align-items: center;">
    <text style="font-weight: bold; margin-bottom: 1;">
      Canvas Color Test - Multiple Colors
    </text>

    <container style="width: fill; height: fill; display: flex; align-items: center; justify-content: center;">
      <canvas
        id="testCanvas"
        width="60"
        height="20"
      />
    </container>

    <text style="color: gray; margin-top: 1;">
      Colored circles and rectangles - Resize to redraw
    </text>
  </container>
</melker>
