<melker>
  <script type="typescript">
    // Helper functions to be available in the context
    const formatMessage = (name) => {
      return `ðŸŒŸ Hello, ${name}! Welcome to Melker with scripts!`;
    };

    const getCurrentTime = () => {
      return new Date().toLocaleTimeString();
    };

    const validateName = (name) => {
      if (!name || name.trim().length === 0) {
        return 'Please enter a valid name';
      }
      if (name.length < 2) {
        return 'Name must be at least 2 characters long';
      }
      return null;
    };

    // Export functions to be available in context
    exports = {
      formatMessage,
      getCurrentTime,
      validateName
    };
  </script>

  <container style="width: 50; height: 15; border: thin; padding: 2; display: flex; flex-direction: column;">
    <text style="font-weight: bold; margin-bottom: 1; text-align: center;">
      ðŸ“œ Melker Script Demo
    </text>

    <text style="margin-bottom: 1;" id="status">
      Status: Ready - Current time will update on interaction
    </text>

    <container style="display: flex; flex-direction: row; margin-bottom: 1;">
      <text style="margin-right: 2;">Name:</text>
      <input
        id="nameInput"
        style="width: 25; border: thin;"
        placeholder="Enter your name"
        onInput="
          const statusEl = context.getElementById('status');
          const validation = context.validateName(event.value);

          if (validation) {
            statusEl.props.text = 'Status: ' + validation;
            statusEl.props.style = { ...statusEl.props.style, color: 'red' };
          } else {
            statusEl.props.text = 'Status: Valid name - ' + context.getCurrentTime();
            statusEl.props.style = { ...statusEl.props.style, color: 'green' };
          }
          context.render();
        "
      />
    </container>

    <container style="display: flex; flex-direction: row; margin-bottom: 2;">
      <button
        title="Greet with Script"
        style="margin-right: 2; background-color: green; color: white;"
        onClick="
          const nameEl = context.getElementById('nameInput');
          const outputEl = context.getElementById('output');
          const name = nameEl ? nameEl.props.value || 'World' : 'World';

          const validation = context.validateName(name);
          if (validation) {
            outputEl.props.text = 'âŒ ' + validation;
            outputEl.props.style = { ...outputEl.props.style, color: 'red' };
          } else {
            outputEl.props.text = context.formatMessage(name);
            outputEl.props.style = { ...outputEl.props.style, color: 'green' };
          }
          context.render();
        "
      />

      <button
        title="Show Time"
        style="margin-right: 2; background-color: blue; color: white;"
        onClick="
          const outputEl = context.getElementById('output');
          outputEl.props.text = 'â° Current time: ' + context.getCurrentTime();
          outputEl.props.style = { ...outputEl.props.style, color: 'blue' };
          context.render();
        "
      />

      <button
        title="Exit"
        style="background-color: gray; color: white;"
        onClick="context.exit();"
      />
    </container>

    <text id="output" style="color: green; font-weight: bold; margin-bottom: 1; text-wrap: wrap; padding: 1">
      Click a button or type your name to see script functions in action!
    </text>

    <text style="color: yellow; text-align: center;">
      This demo shows TypeScript functions defined in script tags!
    </text>
  </container>
</melker>