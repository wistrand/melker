<melker>
<policy>
{
  "name": "Graph: tests/mermaid/flowchart_demo.mmd"
}
</policy>

<style>
.graph {
  width: fill;
  height: auto;
  padding: 1;
  display: flex;
  flex-wrap: wrap;
  gap: 5;
  align-items: flex-start;
  align-content: flex-start;
}
.graph-row { flex-direction: row; }
.graph-col { flex-direction: column; }

.subgraph {
  border: thin;
  padding: 1;
  display: flex;
  flex-wrap: wrap;
  gap: 4;
  align-items: flex-start;
}
.subgraph-row { flex-direction: row; }
.subgraph-col { flex-direction: column; }

.node {
  border: thin;
  padding: 0 1;
  flex-shrink: 0;
  align-self: flex-start;
}
.node-rounded { border: rounded; }
.node-diamond { border: double; }
.node-hexagon { border: thick; }
</style>

<container class="graph graph-col" style="overflow: scroll; height: auto">
  <container id="graph-node-A" class="node">
    <text>melker app.melker</text>
  </container>
  <container id="graph-node-B" class="node node-diamond">
    <text>Local or URL?</text>
  </container>
  <container id="graph-node-D" class="node">
    <text>Download</text>
  </container>
  <container class="subgraph subgraph-row" style="border: none; padding: 0; gap: 5">
    <container id="graph-node-E" class="node node-diamond">
      <text>Has policy?</text>
    </container>
    <container id="graph-node-C" class="node">
      <text>Read file</text>
    </container>
  </container>
  <container class="subgraph subgraph-row" style="border: none; padding: 0; gap: 5">
    <container id="graph-node-F" class="node node-diamond">
      <text>First run?</text>
    </container>
    <container id="graph-node-G" class="node">
      <text>No permissions</text>
    </container>
  </container>
  <container class="subgraph subgraph-row" style="border: none; padding: 0; gap: 5">
    <container id="graph-node-H" class="node">
      <text>Show approval prompt</text>
    </container>
    <container id="graph-node-I" class="node">
      <text>Cached approval</text>
    </container>
  </container>
  <container class="subgraph subgraph-row" style="border: none; padding: 0; gap: 5">
    <container id="graph-node-K" class="node">
      <text>Exit</text>
    </container>
    <container id="graph-node-L" class="node node-diamond">
      <text>TTY?</text>
    </container>
    <container id="graph-node-J" class="node">
      <text>Spawn sandbox</text>
    </container>
  </container>
  <container class="subgraph subgraph-row" style="border: none; padding: 0; gap: 5">
    <container id="graph-node-M" class="node">
      <text>Interactive TUI</text>
    </container>
    <container id="graph-node-N" class="node">
      <text>Single frame output</text>
    </container>
  </container>
  <container class="subgraph subgraph-row" style="border: none; padding: 0; gap: 5">
    <container id="graph-node-P" class="node">
      <text>Event handler</text>
    </container>
    <container id="graph-node-Q" class="node">
      <text>@media re-eval</text>
    </container>
    <container id="graph-node-R" class="node">
      <text>Dev Tools</text>
    </container>
    <container id="graph-node-S" class="node">
      <text>Exit</text>
    </container>
  </container>
  <container id="graph-node-T" class="node">
    <text>Re-render</text>
  </container>
  <container id="graph-node-O" class="node node-diamond">
    <text>User input</text>
  </container>

  <!-- Connectors -->
  <connector from="graph-node-A" to="graph-node-B" arrow="end" />
  <connector from="graph-node-B" to="graph-node-C" arrow="end" label="Local" />
  <connector from="graph-node-B" to="graph-node-D" arrow="end" label="URL" />
  <connector from="graph-node-D" to="graph-node-C" arrow="end" />
  <connector from="graph-node-C" to="graph-node-E" arrow="end" />
  <connector from="graph-node-E" to="graph-node-F" arrow="end" label="Yes" />
  <connector from="graph-node-E" to="graph-node-G" arrow="end" label="No" />
  <connector from="graph-node-F" to="graph-node-H" arrow="end" label="Yes" />
  <connector from="graph-node-F" to="graph-node-I" arrow="end" label="No" />
  <connector from="graph-node-H" to="graph-node-J" arrow="end" label="Approved" />
  <connector from="graph-node-H" to="graph-node-K" arrow="end" label="Denied" />
  <connector from="graph-node-I" to="graph-node-J" arrow="end" />
  <connector from="graph-node-G" to="graph-node-J" arrow="end" />
  <connector from="graph-node-J" to="graph-node-L" arrow="end" />
  <connector from="graph-node-L" to="graph-node-M" arrow="end" label="Yes" />
  <connector from="graph-node-L" to="graph-node-N" arrow="end" label="Piped" />
  <connector from="graph-node-M" to="graph-node-O" arrow="end" />
  <connector from="graph-node-O" to="graph-node-P" arrow="end" label="Key/Mouse" />
  <connector from="graph-node-O" to="graph-node-Q" arrow="end" label="Resize" />
  <connector from="graph-node-O" to="graph-node-R" arrow="end" label="F12" />
  <connector from="graph-node-O" to="graph-node-S" arrow="end" label="Ctrl+C" />
  <connector from="graph-node-P" to="graph-node-T" arrow="end" />
  <connector from="graph-node-Q" to="graph-node-T" arrow="end" />
  <connector from="graph-node-T" to="graph-node-O" arrow="end" />
</container>
</melker>